---
- name: Start the Docker containers
  hosts: localhost
  gather_facts: false

  vars_files:
    - docker_containers.yml

  vars:
    - container_state: started
    - container_privileged: true

  roles:
    - docker

  tags:
    - docker-start


- name: Test the postgres role
  hosts: postgres
  become: yes
  become_method: sudo

  vars:
    - postgres_listen_addresses: "*"
    - postgres_client_auth:
      - type: host
        database: all
        user: all
        address: 0.0.0.0/0
        method: md5

  roles:
    - ansible-role-postgres
    - postgres-test

  tags:
    - postgres


- name: Stop the Docker containers
  hosts: localhost
  gather_facts: false

  vars_files:
    - docker_containers.yml

  vars:
    - container_state: absent

  roles:
    - docker

  tags:
    - docker-stop